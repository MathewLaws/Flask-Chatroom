{% extends "base.html" %} {% block title %}Chat room{% endblock %}

{% block page %}Chat Room{% endblock %}

{% block content %}
<div>
<ul id="messages">
    
</ul>
<div>
    <input type="text" id="message" name="message"></input>
    <button type="button" id="submit" onClick=sendMessage()>Send</button>
</div>
</div>
<script type="text/javascript">

    var socketio = io()

    const messages = document.getElementById("messages")

    const createMessage = (name, message) => {
        text = `<p>${name} - ${message}</p>`
        messages.innerHTML += text
    }

    socketio.on("message", (data) => {
        createMessage(data.name, data.message)
    })

    const sendMessage = () => {
        const message = document.getElementById("message");
        if (message.value == "") return;
        socketio.emit("message", { data: message.value });
        message.value = "";
    }
</script>
{% for msg in messages %}
<script type="text/javascript">
  createMessage("{{msg.name}}", "{{msg.message}}");
</script>
{% endfor %}
{% endblock %}